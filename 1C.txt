#####GET###########
Функция Разобратьпакет(СтрокаJSON) 
	
	Чтение = Новый ЧтениеJSON;
	Чтение.УстановитьСтроку(СтрокаJSON);
	Данные = ПрочитатьJSON(Чтение, Ложь);
	Чтение.Закрыть();	
	
	Возврат Данные;
	
КонецФункции


Функция получить() Экспорт
	// token = "5109358782:AAF5rOAFzLaPSWWvDDAi_DqNq4fB3elEmNQ";
	url = "api.telegram.org";
 
    // В сети есть сайт http://example.com
    // Запросим содержимое его главной страницы.
 
    // Подключаемся к сайту.
    Соединение = Новый HTTPСоединение(
        url, // сервер (хост)
        , // порт, по умолчанию для http используется 80, для https 443
        , // пользователь для доступа к серверу (если он есть)
        , // пароль для доступа к серверу (если он есть)
        , // здесь указывается прокси, если он есть
        5, // таймаут в секундах, 0 или пусто - не устанавливать
        Новый ЗащищенноеСоединениеOpenSSL  // защищенное соединение, если используется https
    );
 
    // Получаем текст корневой страницы через GET-запрос.
    Запрос = Новый HTTPЗапрос("/bot5109358782:AAF5rOAFzLaPSWWvDDAi_DqNq4fB3elEmNQ/getUpdates");
    // Если бы нужна была другая страница, мы бы указали,
    // например, "/about" или "/news".
 
    Результат = Соединение.Получить(Запрос); 
    Сообщить("Нам вернули код: " + Результат.КодСостояния);
	ПакетСообщения = Разобратьпакет(Результат.ПолучитьТелоКакСтроку());
	ПакетСообщения = ?(ПакетСообщения.Свойство("callback_query"), ПакетСообщения.callback_query, ПакетСообщения); 
	//Подписчик = ПакетСообщения.result.message;
	МассивСообщений = ПакетСообщения.result;
	Сообщить(МассивСообщений[1]);
	КрайнийЭлементМассива = МассивСообщений.Количество() - 1;
	//Сообщение = МассивСообщений.ВГраница();
	Сообщение = МассивСообщений[КрайнийЭлементМассива];
	Сообщить(Сообщение);
				
	
	
	// Что примерно означают коды результата запроса:
    // [100, 299] - хороший код возврата
    // [300, 399] - нас перенаправляют на другую страницу,
    //              причём 302 - код постоянного перенаправления
    // [400, 499] - ошибка запроса
    // [500, 599] - ошибка сервера
 
    // в теле результата запроса - текст обычной html страницы
    //Сообщить("Тело результата: " + Результат.ПолучитьТелоКакСтроку());   
    Возврат Сообщение
	КонецФункции








###############POST###################
Функция отправитьСообщение(Подписчик, Текст) Экспорт
	ЗаписьJSON = Новый ЗаписьJSON;
	ПараметрыJSON = Новый ПараметрыЗаписиJSON(ПереносСтрокJSON.Нет, " ", Истина); 
	ЗаписьJSON.УстановитьСтроку();
	Сообщение = Новый Структура;
	Сообщение.Вставить("chat_id", Подписчик);
	Сообщение.Вставить("text", Текст);
	ЗаписьJSON = Новый ЗаписьJSON;
    ПараметрыJSON = Новый ПараметрыЗаписиJSON(ПереносСтрокJSON.Нет, " ", Истина);  
    ЗаписьJSON.УстановитьСтроку(ПараметрыJSON); 
	Массив = Новый Массив;
	Массив.Добавить(Сообщение);
	ЗаписатьJSON(ЗаписьJSON, Сообщение);
	ЗаписьJSON = ЗаписьJSON.Закрыть();
	url = "api.telegram.org";
    // Подключаемся к сайту.
    Соединение = Новый HTTPСоединение(
        url, // сервер (хост)
        , // порт, по умолчанию для http используется 80, для https 443
        , // пользователь для доступа к серверу (если он есть)
        , // пароль для доступа к серверу (если он есть)
        , // здесь указывается прокси, если он есть
        5, // таймаут в секундах, 0 или пусто - не устанавливать
        Новый ЗащищенноеСоединениеOpenSSL  // защищенное соединение, если используется https
    );
 
    // Получаем текст корневой страницы через GET-запрос.
	
	Запрос = Новый HTTPЗапрос("/bot5109358782:AAF5rOAFzLaPSWWvDDAi_DqNq4fB3elEmNQ/sendMessage?chat_id=" + СтрЗаменить(Формат(Подписчик, "ЧДЦ=; ЧС=; ЧРГ=."), ".", "") + "&text=" + Текст);
	Ответ = Соединение.Получить(Запрос);
	
	
	КонецФункции




